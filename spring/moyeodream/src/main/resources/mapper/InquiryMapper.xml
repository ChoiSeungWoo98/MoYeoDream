<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.moyeodream.mapper.InquiryMapper">


    <select id="getTotalList" resultType="com.project.moyeodream.domain.vo.InquiryDTO">
        SELECT RN, INQUIRY_NUMBER, INQUIRY_TITLE, INQUIRY_CONTENT, INQUIRY_ANSWER_BOOL, INQUIRY_VIEWS, INQUIRY_REGISTER_DATE, INQUIRY_UPDATE_DATE, INQUIRY_MEMBER_NUMBER, MEMBER_NICKNAME
        FROM
        (
            SELECT
            ROWNUM RN, INQUIRY_NUMBER, INQUIRY_TITLE, INQUIRY_CONTENT, INQUIRY_ANSWER_BOOL, INQUIRY_VIEWS, INQUIRY_REGISTER_DATE, INQUIRY_UPDATE_DATE, ti.INQUIRY_MEMBER_NUMBER, tm.MEMBER_NICKNAME
            FROM TBL_INQUIRY ti JOIN TBL_MEMBER tm
            ON ti.INQUIRY_MEMBER_NUMBER = tm.MEMBER_NUMBER
        <![CDATA[
            WHERE ROWNUM <= #{pageNum} * #{amount}
        )
        WHERE RN > ((#{pageNum} -1) * #{amount})
        ORDER BY INQUIRY_NUMBER DESC
        ]]>
    </select>

    <!-- 게시글 전체 개수 -->
    <select id="getTotal" resultType="_int">
        SELECT COUNT(INQUIRY_NUMBER) FROM TBL_INQUIRY
    </select>

    <insert id="insert">
        INSERT INTO TBL_INQUIRY (INQUIRY_NUMBER, INQUIRY_TITLE, INQUIRY_CONTENT, INQUIRY_MEMBER_NUMBER)
        VALUES (SEQ_INQUIRY.NEXTVAL, #{inquiryTitle}, #{inquiryContent}, #{inquiryMemberNumber})
    </insert>

    <select id="getList" resultType="com.project.moyeodream.domain.vo.InquiryDTO">
        SELECT INQUIRY_NUMBER, INQUIRY_TITLE, INQUIRY_CONTENT, INQUIRY_REGISTER_DATE, INQUIRY_UPDATE_DATE, INQUIRY_MEMBER_NUMBER
        FROM TBL_INQUIRY
        WHERE INQUIRY_NUMBER = #{inquiryNumber}
    </select>

    <update id="update">
        UPDATE TBL_INQUIRY
        SET INQUIRY_TITLE = #{inquiryTitle}, INQUIRY_CONTENT = #{inquiryContent}, INQUIRY_UPDATE_DATE = SYSDATE
        WHERE INQUIRY_NUMBER = #{inquiryNumber}
    </update>

    <update id="visit">
        UPDATE TBL_INQUIRY
        SET INQUIRY_VIEWS = INQUIRY_VIEWS+1
        WHERE INQUIRY_NUMBER = #{inquiryNumber}
    </update>

    <delete id="delete">
        DELETE FROM TBL_INQUIRY
        WHERE INQUIRY_NUMBER = #{inquiryNumber}
    </delete>

    <select id="selectNickName" resultType="string">
        SELECT MEMBER_NICKNAME FROM TBL_MEMBER
        WHERE MEMBER_NUMBER = #{inquiryMemberNumber}
    </select>
</mapper>